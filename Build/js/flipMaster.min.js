var flipMaster=function($,document){"use strict";var $cardFlip,$backBtn,$forwardBtn,$cardContent,contentArray=[],publicAPI,transitionEvent=whichTransitionEvent(),flip,classToggle,infiniteFlip=false,count=0,pos=0;function whichTransitionEvent(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions){if(el.style[t]!==undefined){return transitions[t]}}}function flipForward(getClassName){return getClassName?"f90":$cardFlip.addClass("f90")}function flipBackward(getClassName){return getClassName?"b90":$cardFlip.addClass("b90")}function buttonHandler(evt){var currentBtn=evt.target,maxLen=contentArray.length;flip=currentBtn.id==="btnF"?flipForward:flipBackward;if(infiniteFlip){if(flip(true)==="f90"&&pos+1===maxLen){pos-=maxLen}else if(flip(true)==="b90"&&pos-1<=0){pos=maxLen}}else{if(pos<=0&&flip(true)==="b90"||pos+1===maxLen&&flip(true)==="f90"){return}}flip();$backBtn.unbind("click",buttonHandler);$forwardBtn.unbind("click",buttonHandler)}function disableAnimation(className){classToggle=className==="f90"?"b90":"f90";$cardFlip.addClass("no-transition "+classToggle).removeClass(className)}function finishFlipAnimation(className){classToggle=className==="f90"?"b90":"f90";$cardFlip.removeClass("no-transition "+classToggle)}function triggerReflow(){$cardFlip.outerHeight()}function insertContent(content){$cardContent.html(content)}function getContent(){flip(true)==="f90"?pos++:pos--;return contentArray.filter(function(e,i){return i===pos})[0]}function animationEndHandler(evt){if(evt.originalEvent.propertyName==="transform"){if(count>=1){count=0;$backBtn.bind("click",buttonHandler);$forwardBtn.bind("click",buttonHandler);return}else{var content=getContent(),flipClass=flip(true);disableAnimation(flipClass);insertContent(content);triggerReflow();finishFlipAnimation(flipClass)}count++}}function loadData(data){for(var i=0;i<data.length;i++){contentArray.push(data[i])}}function init(opts){$cardFlip=$(opts.cardFlip);$backBtn=$(opts.backBtn);$forwardBtn=$(opts.forwardBtn);$cardContent=$(opts.cardContent);infiniteFlip=opts.infiniteFlip;insertContent(contentArray[0]);transitionEvent&&$cardFlip.bind(transitionEvent,animationEndHandler);$backBtn.bind("click",buttonHandler);$forwardBtn.bind("click",buttonHandler)}publicAPI={loadData:loadData,init:init};return publicAPI}(jQuery,document);